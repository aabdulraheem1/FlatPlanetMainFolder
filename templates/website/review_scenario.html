{% extends 'website/base.html' %}
{% load static %}
<!DOCTYPE html>
<html lang="en">

{% block content %}

<head>
    <meta charset="UTF-8">
    <title>Review Scenario</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- Include Bootstrap CSS -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
</head>

<body>
    <!-- Version Information -->
    <div class="container mt-3">
        <div class="alert alert-info" role="alert">
            <strong>Version:</strong> {{ version }}
        </div>
    </div>

    <!-- Section 1: Forecast Analysis -->
    <div class="container mt-5">
        <h2>Forecast Analysis</h2>
        <ul class="nav nav-tabs" id="forecastTabs" role="tablist">
            <li class="nav-item">
                <a class="nav-link active" id="product-group-tab" data-toggle="tab" href="#product-group" role="tab"
                    aria-controls="product-group" aria-selected="true">By Product Group</a>
            </li>
            <li class="nav-item">
                <a class="nav-link" id="parent-product-group-tab" data-toggle="tab" href="#parent-product-group"
                    role="tab" aria-controls="parent-product-group" aria-selected="false">By Parent Product Group</a>
            </li>
            <li class="nav-item">
                <a class="nav-link" id="region-tab" data-toggle="tab" href="#region" role="tab" aria-controls="region"
                    aria-selected="false">By Region</a>
            </li>
            <li class="nav-item">
                <a class="nav-link" id="customer-tab" data-toggle="tab" href="#customer" role="tab"
                    aria-controls="customer" aria-selected="false">By Customer</a>
            </li>
        </ul>

        <div class="tab-content" id="forecastTabsContent">
            <div class="tab-pane fade show active" id="product-group" role="tabpanel"
                aria-labelledby="product-group-tab">
                <canvas id="productGroupChart" width="400" height="200"></canvas>
            </div>
            <div class="tab-pane fade" id="parent-product-group" role="tabpanel"
                aria-labelledby="parent-product-group-tab">
                <canvas id="ParentGroupChart" width="400" height="200"></canvas>
                <script>
                    const parentProductGroupData = {{ chart_data_parent_product_group| safe }};
                    const ctxParentGroup = document.getElementById('ParentGroupChart').getContext('2d');

                    // Prepare datasets for each parent product group
                    const datasets = Object.keys(parentProductGroupData).map(group => ({
                        label: group, // Legend for the parent product group
                        data: parentProductGroupData[group].tons, // Tonnes data
                        backgroundColor: `rgba(${Math.floor(Math.random() * 255)}, ${Math.floor(Math.random() * 255)}, ${Math.floor(Math.random() * 255)}, 0.6)`,
                        borderColor: `rgba(${Math.floor(Math.random() * 255)}, ${Math.floor(Math.random() * 255)}, ${Math.floor(Math.random() * 255)}, 1)`,
                        borderWidth: 1
                    }));

                    // Use the labels from the first group (assuming all groups have the same labels)
                    const labels = parentProductGroupData[Object.keys(parentProductGroupData)[0]].labels;

                    new Chart(ctxParentGroup, {
                        type: 'bar',
                        data: {
                            labels: labels, // Monthly buckets
                            datasets: datasets // Datasets for each parent product group
                        },
                        options: {
                            responsive: true,
                            plugins: {
                                title: {
                                    display: true,
                                    text: 'Forecast by Parent Product Group (Stacked)'
                                },
                                tooltip: {
                                    mode: 'index',
                                    intersect: false
                                }
                            },
                            scales: {
                                x: {
                                    stacked: true, // Enable stacking on the x-axis
                                    title: {
                                        display: true,
                                        text: 'Month'
                                    }
                                },
                                y: {
                                    stacked: true, // Enable stacking on the y-axis
                                    title: {
                                        display: true,
                                        text: 'Tons'
                                    },
                                    beginAtZero: true
                                }
                            }
                        }
                    });
                </script>
            </div>
            <div class="tab-pane fade" id="region" role="tabpanel" aria-labelledby="region-tab">
                <canvas id="regionChart" width="400" height="200"></canvas>
            </div>
            <div class="tab-pane fade" id="customer" role="tabpanel" aria-labelledby="customer-tab">
                <canvas id="customerChart" width="400" height="200"></canvas>
            </div>
        </div>
    </div>

    <!-- Section 2: Foundry Tabs -->
    <div class="container mt-5">
        <h2>Foundry Review</h2>
        <ul class="nav nav-tabs" id="foundryTabs" role="tablist">
            <li class="nav-item">
                <a class="nav-link active" id="mt-joli-tab" data-toggle="tab" href="#mt-joli" role="tab"
                    aria-controls="mt-joli" aria-selected="true">Mt Joli</a>
            </li>
            <li class="nav-item">
                <a class="nav-link" id="coimbatore-tab" data-toggle="tab" href="#coimbatore" role="tab"
                    aria-controls="coimbatore" aria-selected="false">Coimbatore</a>
            </li>
            <li class="nav-item">
                <a class="nav-link" id="xuzhou-tab" data-toggle="tab" href="#xuzhou" role="tab" aria-controls="xuzhou"
                    aria-selected="false">Xuzhou</a>
            </li>
            <li class="nav-item">
                <a class="nav-link" id="merlimau-tab" data-toggle="tab" href="#merlimau" role="tab"
                    aria-controls="merlimau" aria-selected="false">Merlimau</a>
            </li>
        </ul>

        <div class="tab-content" id="foundryTabsContent">
            <!-- Mt Joli Chart -->
            <div class="tab-pane fade show active" id="mt-joli" role="tabpanel" aria-labelledby="mt-joli-tab">
                <canvas id="mtJoliChart" width="400" height="200"></canvas>
                <script>
                    const mtJoliData = {{ mt_joli_chart_data| safe }};
                    const mtJoliTopProducts = {{ mt_joli_top_products| safe }};
                    const ctxMtJoli = document.getElementById('mtJoliChart').getContext('2d');

                    new Chart(ctxMtJoli, {
                        type: 'bar',
                        data: {
                            labels: mtJoliData.labels,
                            datasets: [
                                {
                                    label: 'Tonnes',
                                    data: mtJoliData.tons,
                                    backgroundColor: 'rgba(75, 192, 192, 0.2)',
                                    borderColor: 'rgba(75, 192, 192, 1)',
                                    borderWidth: 1
                                },
                                {
                                    label: 'Dress Mass',
                                    data: mtJoliData.dress_mass,
                                    type: 'line',
                                    borderColor: 'rgba(255, 99, 132, 1)',
                                    backgroundColor: 'rgba(255, 99, 132, 0.2)',
                                    borderWidth: 2,
                                    fill: false,
                                    tension: 0.4
                                }
                            ]
                        },
                        options: {
                            responsive: true,
                            plugins: {
                                tooltip: {
                                    callbacks: {
                                        afterBody: function (context) {
                                            const month = context[0].label;
                                            const top = mtJoliTopProducts[month];
                                            if (!top) return '';
                                            return 'Top 10 Products:\n' + top.map(
                                                (p, i) => `${i + 1}. ${p[0]}: ${p[1]}`
                                            ).join('\n');
                                        }
                                    }
                                }
                            },
                            scales: {
                                x: {
                                    title: {
                                        display: true,
                                        text: 'Month'
                                    }
                                },
                                y: {
                                    title: {
                                        display: true,
                                        text: 'Tonnes / Dress Mass'
                                    },
                                    beginAtZero: true
                                }
                            }
                        }
                    });
                </script>
            </div>
            <!-- Coimbatore Chart -->
            <div class="tab-pane fade" id="coimbatore" role="tabpanel" aria-labelledby="coimbatore-tab">
                <canvas id="coimbatoreChart" width="400" height="200"></canvas>
                <script>
                    const coimbatoreData = {{ coimbatore_chart_data| safe }};
                    const ctxCoimbatore = document.getElementById('coimbatoreChart').getContext('2d');

                    new Chart(ctxCoimbatore, {
                        type: 'bar',
                        data: {
                            labels: coimbatoreData.labels,
                            datasets: [
                                {
                                    label: 'Tonnes',
                                    data: coimbatoreData.tons,
                                    backgroundColor: 'rgba(75, 192, 192, 0.2)',
                                    borderColor: 'rgba(75, 192, 192, 1)',
                                    borderWidth: 1
                                },
                                {
                                    label: 'Dress Mass',
                                    data: coimbatoreData.dress_mass,
                                    type: 'line',
                                    borderColor: 'rgba(255, 99, 132, 1)',
                                    backgroundColor: 'rgba(255, 99, 132, 0.2)',
                                    borderWidth: 2,
                                    fill: false,
                                    tension: 0.4
                                }
                            ]
                        },
                        options: {
                            responsive: true,
                            scales: {
                                x: {
                                    title: {
                                        display: true,
                                        text: 'Month'
                                    }
                                },
                                y: {
                                    title: {
                                        display: true,
                                        text: 'Tonnes / Dress Mass'
                                    },
                                    beginAtZero: true
                                }
                            }
                        }
                    });
                </script>
            </div>

            <!-- Xuzhou Chart -->
            <div class="tab-pane fade" id="xuzhou" role="tabpanel" aria-labelledby="xuzhou-tab">
                <canvas id="xuzhouChart" width="400" height="200"></canvas>
                <script>
                    const xuzhouData = {{ xuzhou_chart_data| safe }};
                    const ctxXuzhou = document.getElementById('xuzhouChart').getContext('2d');

                    new Chart(ctxXuzhou, {
                        type: 'bar',
                        data: {
                            labels: xuzhouData.labels,
                            datasets: [
                                {
                                    label: 'Tonnes',
                                    data: xuzhouData.tons,
                                    backgroundColor: 'rgba(75, 192, 192, 0.2)',
                                    borderColor: 'rgba(75, 192, 192, 1)',
                                    borderWidth: 1
                                },
                                {
                                    label: 'Dress Mass',
                                    data: xuzhouData.dress_mass,
                                    type: 'line',
                                    borderColor: 'rgba(255, 99, 132, 1)',
                                    backgroundColor: 'rgba(255, 99, 132, 0.2)',
                                    borderWidth: 2,
                                    fill: false,
                                    tension: 0.4
                                }
                            ]
                        },
                        options: {
                            responsive: true,
                            scales: {
                                x: {
                                    title: {
                                        display: true,
                                        text: 'Month'
                                    }
                                },
                                y: {
                                    title: {
                                        display: true,
                                        text: 'Tonnes / Dress Mass'
                                    },
                                    beginAtZero: true
                                }
                            }
                        }
                    });
                </script>
            </div>

            <!-- Merlimau Chart -->
            <div class="tab-pane fade" id="merlimau" role="tabpanel" aria-labelledby="merlimau-tab">
                <canvas id="merlimauChart" width="400" height="200"></canvas>
                <script>
                    const merlimauData = {{ merlimau_chart_data| safe }};
                    const ctxMerlimau = document.getElementById('merlimauChart').getContext('2d');

                    new Chart(ctxMerlimau, {
                        type: 'bar',
                        data: {
                            labels: merlimauData.labels,
                            datasets: [
                                {
                                    label: 'Tonnes',
                                    data: merlimauData.tons,
                                    backgroundColor: 'rgba(75, 192, 192, 0.2)',
                                    borderColor: 'rgba(75, 192, 192, 1)',
                                    borderWidth: 1
                                },
                                {
                                    label: 'Dress Mass',
                                    data: merlimauData.dress_mass,
                                    type: 'line',
                                    borderColor: 'rgba(255, 99, 132, 1)',
                                    backgroundColor: 'rgba(255, 99, 132, 0.2)',
                                    borderWidth: 2,
                                    fill: false,
                                    tension: 0.4
                                }
                            ]
                        },
                        options: {
                            responsive: true,
                            scales: {
                                x: {
                                    title: {
                                        display: true,
                                        text: 'Month'
                                    }
                                },
                                y: {
                                    title: {
                                        display: true,
                                        text: 'Tonnes / Dress Mass'
                                    },
                                    beginAtZero: true
                                }
                            }
                        }
                    });
                </script>
            </div>
        </div>
    </div>

    <!-- Section 3: Supplier Tabs -->
    <div class="container mt-5">
        <h2>Supplier Review</h2>
        <ul class="nav nav-tabs" id="supplierTabs" role="tablist">
            <li class="nav-item">
                <a class="nav-link active" id="supplier-a-tab" data-toggle="tab" href="#supplier-a" role="tab"
                    aria-controls="supplier-a" aria-selected="true">Supplier A</a>
            </li>
            <li class="nav-item">
                <a class="nav-link" id="supplier-b-tab" data-toggle="tab" href="#supplier-b" role="tab"
                    aria-controls="supplier-b" aria-selected="false">Supplier B</a>
            </li>
        </ul>

        <div class="tab-content" id="supplierTabsContent">
            <div class="tab-pane fade show active" id="supplier-a" role="tabpanel" aria-labelledby="supplier-a-tab">
                <canvas id="supplierAChart" width="400" height="200"></canvas>
            </div>
            <div class="tab-pane fade" id="supplier-b" role="tabpanel" aria-labelledby="supplier-b-tab">
                <canvas id="supplierBChart" width="400" height="200"></canvas>
            </div>
        </div>
    </div>

    <script src="{% static 'js/review_scenario_charts.js' %}"></script>
    <!-- Include jQuery and Bootstrap JS -->
    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.2/dist/umd/popper"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
</body>
{% endblock %}

</html>