{% extends 'website/base.html' %}

{% block title %}Update Master Data Plan{% endblock %}

{% block content %}
<h2>Update Master Data Plan</h2>

<!-- JavaScript-based filter -->
<div>
    <label for="foundryFilter">Filter by Foundry:</label>
    <input type="text" id="foundryFilter" onkeyup="filterTable('foundryFilter', 1)" placeholder="Search for Foundry..">

    <label for="yearFilter">Filter by Year:</label>
    <input type="text" id="yearFilter" onkeyup="filterTable('yearFilter', 2)" placeholder="Search for Year..">
</div>

<form method="post">
    {% csrf_token %}
    <table class="table" id="dataTable">
        <thead>
            <tr>
                <th>Foundry</th>
                <th>Year</th>
                <th>Pouring Days per Week</th>
                <th>Calendar Days</th>
                <th>Yield</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody>
            {{ formset.management_form }}
            {% for form in formset %}
            <tr>
                <td>{{ form.Foundry }}</td>
                <td>{{ form.Month }}</td>
                <td>{{ form.PouringDaysperweek }}</td>
                <td>{{ form.CalendarDays }}</td>
                <td>{{ form.Yield }}</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
    <button type="submit" class="btn btn-primary">Save Changes</button>
</form>

<script>
    function filterTable(inputId, columnIndex) {
        const input = document.getElementById(inputId);
        const filter = input.value.toUpperCase();
        const table = document.getElementById("dataTable");
        const rows = table.getElementsByTagName("tr");

        for (let i = 1; i < rows.length; i++) {
            const cell = rows[i].getElementsByTagName("td")[columnIndex];
            if (cell) {
                const textValue = cell.textContent || cell.innerText;
                rows[i].style.display = textValue.toUpperCase().indexOf(filter) > -1 ? "" : "none";
            }
        }
    }
</script>
{% endblock %}