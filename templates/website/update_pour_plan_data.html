{% extends 'website/base.html' %}

{% block title %}Update Pour Plan Data{% endblock %}

{% block content %}
<h2>Update Pour Plan Data</h2>

<!-- Display success messages -->
{% if messages %}
<div class="alert alert-success">
    {% for message in messages %}
    <p>{{ message }}</p>
    {% endfor %}
</div>
{% endif %}

<!-- Filter Form -->
<form method="get" id="filterForm">
    <label for="foundryFilter">Filter by Foundry:</label>
    <input type="text" id="foundryFilter" name="foundry" placeholder="Search for Foundry..">

    <label for="monthFilter">Filter by Month:</label>
    <input type="text" id="monthFilter" name="month" placeholder="Search for Month..">

    <button type="submit">Search</button>
</form>

<form method="post">
    {% csrf_token %}
    <table id="dataTable">
        <thead>
            <tr>
                <th>Foundry</th>
                <th>Month</th>
                <th>Calendar Days</th>
                <th>Yield</th>
                <th>Waster Percentage</th>
                <th>Planned Maintenance Days</th>
                <th>Public Holidays</th>
                <th>Weekends</th>
                <th>Other Non Pouring Days</th>
                <th>Available Days</th>
                <th>Heats Per Day</th>
                <th>Tons Per Heat</th>
                <th>Plan Dress Mass</th>
            </tr>
        </thead>
        <tbody>
            {{ formset.management_form }}
            {% for form in formset %}
            <tr>
                {{ form.id }} <!-- Render the hidden id field -->
                <td>
                    {{ form.Foundry }}
                    {% if form.Foundry.errors %}
                    <div class="text-danger small">{{ form.Foundry.errors.0 }}</div>
                    {% endif %}
                </td>
                <td>
                    {{ form.Month }}
                    {% if form.Month.errors %}
                    <div class="text-danger small">{{ form.Month.errors.0 }}</div>
                    {% endif %}
                </td>
                <td>
                    {{ form.CalendarDays }}
                    {% if form.CalendarDays.errors %}
                    <div class="text-danger small">{{ form.CalendarDays.errors.0 }}</div>
                    {% endif %}
                </td>
                <td>
                    {{ form.Yield }}
                    {% if form.Yield.errors %}
                    <div class="text-danger small">{{ form.Yield.errors.0 }}</div>
                    {% endif %}
                </td>
                <td>
                    {{ form.WasterPercentage }}
                    {% if form.WasterPercentage.errors %}
                    <div class="text-danger small">{{ form.WasterPercentage.errors.0 }}</div>
                    {% endif %}
                </td>
                <td>
                    {{ form.PlannedMaintenanceDays }}
                    {% if form.PlannedMaintenanceDays.errors %}
                    <div class="text-danger small">{{ form.PlannedMaintenanceDays.errors.0 }}</div>
                    {% endif %}
                </td>
                <td>
                    {{ form.PublicHolidays }}
                    {% if form.PublicHolidays.errors %}
                    <div class="text-danger small">{{ form.PublicHolidays.errors.0 }}</div>
                    {% endif %}
                </td>
                <td>
                    {{ form.Weekends }}
                    {% if form.Weekends.errors %}
                    <div class="text-danger small">{{ form.Weekends.errors.0 }}</div>
                    {% endif %}
                </td>
                <td>
                    {{ form.OtherNonPouringDays }}
                    {% if form.OtherNonPouringDays.errors %}
                    <div class="text-danger small">{{ form.OtherNonPouringDays.errors.0 }}</div>
                    {% endif %}
                </td>
                <td>
                    {{ form.AvailableDays }}
                    {% if form.AvailableDays.errors %}
                    <div class="text-danger small">{{ form.AvailableDays.errors.0 }}</div>
                    {% endif %}
                </td>
                <td>
                    {{ form.heatsperdays }}
                    {% if form.heatsperdays.errors %}
                    <div class="text-danger small">{{ form.heatsperdays.errors.0 }}</div>
                    {% endif %}
                </td>
                <td>
                    {{ form.TonsPerHeat }}
                    {% if form.TonsPerHeat.errors %}
                    <div class="text-danger small">{{ form.TonsPerHeat.errors.0 }}</div>
                    {% endif %}
                </td>
                <td>
                    {{ form.PlanDressMass }}
                    {% if form.PlanDressMass.errors %}
                    <div class="text-danger small">{{ form.PlanDressMass.errors.0 }}</div>
                    {% endif %}
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
    <button type="submit">Save Changes</button>
    <a href="{% url 'edit_scenario' scenario.version %}" class="btn btn-primary ml-2">Back to Edit Scenario</a>
</form>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const form = document.querySelector('form[method="post"]');
    if (form) {
        form.addEventListener('submit', function(e) {
            // Allow form submission to continue
            setTimeout(function() {
                window.location.href = "{% url 'edit_scenario' scenario.version %}";
            }, 500);
        });
    }
});
</script>
{% endblock %}