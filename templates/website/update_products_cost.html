{% extends "website/base.html" %}
{% block content %}
<h3>Edit Product Costs for {{ scenario.version }}</h3>

<form method="get" class="form-inline mb-3">
    <div class="form-group">
        <label for="product" class="mr-2">Filter by Product:</label>
        <input type="text" id="product" name="product" value="{{ product_filter }}" class="form-control mr-2">
    </div>
    <div class="form-group">
        <label for="site" class="mr-2">Filter by Site:</label>
        <input type="text" id="site" name="site" value="{{ site_filter }}" class="form-control mr-2">
    </div>
    <button type="submit" class="btn btn-primary">Filter</button>
</form>

<form method="post">
    {% csrf_token %}
    <table class="table">
        <thead>
            <tr>
                <th>Product</th>
                <th>Site</th>
<th>Cost AUD</th>
<th>Cost Date</th>
<th>Revenue Cost AUD</th>
</tr>
</thead>
<tbody>
    {% for cost in costs %}
    <tr>
        <td>{{ cost.product.Product }}</td>
        <td>{{ cost.site.SiteName }}</td>
        <td>
            <input type="number" step="0.01" name="cost_aud_{{ cost.id }}" value="{{ cost.cost_aud|default_if_none:'' }}">
        </td>
        <td>
            <input type="date" name="cost_date_{{ cost.id }}" value="{{ cost.cost_date|date:'Y-m-d' }}">
        </td>
        <td>
            <input type="number" step="0.01" name="revenue_cost_aud_{{ cost.id }}" value="{{ cost.revenue_cost_aud|default_if_none:'' }}">
        </td>
    </tr>
    {% endfor %}
</tbody>
    </table>
    <!-- Pagination controls -->
<nav aria-label="Page navigation">
  <ul class="pagination">
    {% if page_obj.has_previous %}
      <li class="page-item">
        <a class="page-link" href="?page={{ page_obj.previous_page_number }}&product={{ product_filter }}&site={{ site_filter }}" aria-label="Previous">
          <span aria-hidden="true">&laquo;</span>
        </a>
      </li>
    {% else %}
      <li class="page-item disabled"><span class="page-link">&laquo;</span></li>
    {% endif %}

    {# Show up to 5 page numbers centered on the current page #}
    {% with total=page_obj.paginator.num_pages current=page_obj.number %}
      {% if total <= 5 %}
        {% for num in page_obj.paginator.page_range %}
          {% if page_obj.number == num %}
            <li class="page-item active"><span class="page-link">{{ num }}</span></li>
          {% else %}
            <li class="page-item"><a class="page-link" href="?page={{ num }}&product={{ product_filter }}&site={{ site_filter }}">{{ num }}</a></li>
          {% endif %}
        {% endfor %}
      {% else %}
        {% for num in page_obj.paginator.page_range %}
          {% if num >= current|add:'-2' and num <= current|add:'2' %}
            {% if page_obj.number == num %}
              <li class="page-item active"><span class="page-link">{{ num }}</span></li>
            {% else %}
              <li class="page-item"><a class="page-link" href="?page={{ num }}&product={{ product_filter }}&site={{ site_filter }}">{{ num }}</a></li>
            {% endif %}
          {% endif %}
        {% endfor %}
      {% endif %}
    {% endwith %}

    {% if page_obj.has_next %}
      <li class="page-item">
        <a class="page-link" href="?page={{ page_obj.next_page_number }}&product={{ product_filter }}&site={{ site_filter }}" aria-label="Next">
          <span aria-hidden="true">&raquo;</span>
        </a>
      </li>
    {% else %}
      <li class="page-item disabled"><span class="page-link">&raquo;</span></li>
    {% endif %}
  </ul>
</nav>
    <button type="submit" class="btn btn-success">Save Changes</button>
    <a href="{% url 'edit_scenario' scenario.version %}" class="btn btn-secondary">Back</a>
</form>
{% endblock %}